# CloudTun

> 基于云（腾讯云）的超低成本轻量网络代理方案

## 方案架构

1. 云主机的竞价实例极其便宜。
2. 在需要代理时使用腾讯云API自动购买主机，使用包含有代理服务的自定义镜像。
3. 实现一个超轻量的代理服务，该服务除了代理外，还会在连续10分钟没有客户端请求时调用腾讯云API销毁当前主机。
4. 实现一个超轻量的代理客户端和服务端通信，用于 macos/windows。
5. 实现一个超轻量的 tun 流量转换器和服务端通信，用于安卓/IOS。
6. 使用 Tauri 框架实现跨端 GUI 软件。

## 代理协议

因为每次购买的主机 IP 都会变化，因此不需要 v2ray/shadowsocks 一类的混淆对抗型代理服务。且仅仅是为了自己使用，也不需要任何健壮性和稳定性，手撸一个基于 `websocket` 的透明转发方案即可。

客户端通过 websocket 发起链接时，通过普通的 http headers 传递代理目标，比如 `x-connect-host:baidu.com;x-connect-port:80;`，然后每收到 1kb 的 tun 流量包装成一条 websocket 二进制消息发给服务端。服务端每收到一条 websocket 二进制消息，就转发到这个目标的 tcp 连接上既可；同理，服务端收到目标 tcp 连接返回的数据，每 1kb 包装一条 websocket 二进制消息吐给客户端，客户端收到后把流量取出来再吐给 tun。

此外，在客户端向服务端发送 websocket 消息时，会使用最最简单的 `xor` 加密算法。密码由客户端随机生成并也是在 websocket 链接时通过 headers 传递给服务端。